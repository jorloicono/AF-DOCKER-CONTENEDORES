# Docker Compose: Instalación y Uso Paso a Paso

Docker Compose permite definir y ejecutar **aplicaciones multicontenedor** usando un único archivo `docker-compose.yml`. Funciona en macOS, Windows y Linux 64-bit.

> Nota: Docker Compose requiere que Docker Engine esté instalado localmente o en un host remoto.

---

## 1️⃣ Instalar Docker Compose en Ubuntu

### Paso 1: Actualizar el gestor de paquetes

```bash
sudo apt-get update
```

### Paso 2: Descargar Docker Compose

```bash
sudo curl -L "https://github.com/docker/compose/releases/download/<version>/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
```

> Sustituye `<version>` por la versión más reciente disponible.

### Paso 3: Aplicar permisos ejecutables

```bash
sudo chmod +x /usr/local/bin/docker-compose
```

### Paso 4: Verificar instalación

```bash
docker-compose --version
```

---

## 2️⃣ Crear Proyecto de Ejemplo con Docker Compose

Queremos montar un **API en Python (Flask)** y un **sitio web en PHP** que consuma la API.

### Paso 1: Crear directorio del proyecto

```bash
mkdir dockerComposeProject
cd dockerComposeProject
```

---

### Paso 2: Crear servicio Python (API)

```bash
mkdir product
cd product
```

#### Archivo `requirements.txt`

```txt
flask
flask-restful
```

#### Archivo `api.py`

```python
from flask import Flask
from flask_restful import Resource, Api

app = Flask(__name__)
api = Api(app)

class Fruits(Resource):
    def get(self):
        return {'fruits': ['Mango', 'Pomegranate', 'Orange', 'Litchi']}

api.add_resource(Fruits, '/')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80, debug=True)
```

#### Archivo `Dockerfile` del servicio API

```dockerfile
FROM python:3
WORKDIR /usr/src/app
COPY requirements.txt . 
RUN pip install --no-cache-dir -r requirements.txt
COPY . . 
CMD ["python", "api.py"]
```

---

### Paso 3: Crear sitio web PHP

```bash
cd ..
mkdir website
cd website
```

#### Archivo `index.php`

```php
<!DOCTYPE html>
<html lang="en">
<head>
   <title>Fruit Service</title>
</head>
<body>
   <h1>Welcome to India's Fruit Shop</h1>
   <ul>
       <?php
       $obj = json_decode(file_get_contents('http://fruit-service:80/'));
       $fruits = $obj->fruits;
       foreach($fruits as $fruit){
           echo "<li>$fruit</li>";
       }
       ?>
   </ul>
</body>
</html>
```

---

### Paso 4: Crear archivo `docker-compose.yml`

```yaml
version: "3"

services:
  fruit-service:
    build: ./product
    volumes:
      - ./product:/usr/src/app
    ports:
      - 5001:80

  website:
    image: php:apache
    volumes:
      - ./website:/var/www/html
    ports:
      - 5000:80
    depends_on:
      - fruit-service
```

> **Explicación rápida:**

* `fruit-service`: Servicio API en Python, puerto interno 80 mapeado a 5001 del host.
* `website`: Servicio PHP, puerto interno 80 mapeado a 5000 del host, depende de `fruit-service`.

---

### Paso 5: Estructura de carpetas

```
dockerComposeProject/
│
├─ product/
│  ├─ Dockerfile
│  ├─ requirements.txt
│  └─ api.py
│
├─ website/
│  └─ index.php
│
└─ docker-compose.yml
```

---

## 3️⃣ Ejecutar la aplicación

```bash
docker-compose up -d
```

* `-d` ejecuta los contenedores en **segundo plano**.
* La web estará disponible en: `http://localhost:5000`
* La API estará disponible en: `http://localhost:5001`

---

### Detener la aplicación

```bash
docker-compose stop
```

---

## 4️⃣ Comandos útiles de Docker Compose

| Comando                 | Descripción                                                | Ejemplo                                  |
| ----------------------- | ---------------------------------------------------------- | ---------------------------------------- |
| `docker-compose up`     | Inicia todos los servicios                                 | `docker-compose up -d`                   |
| `docker-compose down`   | Detiene y elimina contenedores, redes y volúmenes creados  | `docker-compose down`                    |
| `docker-compose ps`     | Lista todos los contenedores con su estado                 | `docker-compose ps`                      |
| `docker-compose logs`   | Muestra logs de los servicios                              | `docker-compose logs website`            |
| `docker-compose exec`   | Ejecuta un comando dentro de un contenedor                 | `docker-compose exec fruit-service bash` |
| `docker-compose build`  | Reconstruye las imágenes definidas en `docker-compose.yml` | `docker-compose build`                   |
| `docker-compose pull`   | Descarga imágenes desde el repositorio                     | `docker-compose pull`                    |
| `docker-compose start`  | Inicia contenedores previamente creados sin recrearlos     | `docker-compose start`                   |
| `docker-compose stop`   | Detiene contenedores sin eliminarlos                       | `docker-compose stop`                    |
| `docker-compose config` | Verifica la configuración y detecta errores                | `docker-compose config`                  |


